<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مؤقت المسح على الخفين</title>
    <style>
        body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; text-align: center; padding: 2rem; background: #f4f4f9; color: #333; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { margin-top: 0; color: #27ae60; }
        p { color: #7f8c8d; }
        #timer { font-size: 3rem; font-weight: bold; margin: 2rem 0; color: #2c3e50; direction: ltr; /* للأرقام */ }
        button { background: #27ae60; color: white; border: none; padding: 1rem 2rem; font-size: 1.2rem; border-radius: 8px; cursor: pointer; width: 100%; font-family: inherit; font-weight: bold; }
        button#reset { background: #c0392b; margin-top: 1rem; display: none; }
        button:active { opacity: 0.9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>المسح على الخفين</h1>
        <p>متابعة مدة صلاحية المسح (يوم وليلة)</p>
        
        <div id="timer">24:00:00</div>
        
        <button id="startBtn" onclick="startTimer()">بدأتُ المسح الآن</button>
        <button id="resetBtn" onclick="resetTimer()">إعادة تعيين / غسل الرجلين</button>
    </div>

    <script>
        let interval;
        const DURATION = 24 * 60 * 60 * 1000; // 24 ساعة بالمللي ثانية

        function updateDisplay(ms) {
            if (ms <= 0) {
                document.getElementById('timer').innerText = "انتهى الوقت!";
                document.getElementById('timer').style.color = "#c0392b";
                document.getElementById('timer').style.fontSize = "2.5rem";
                return;
            }
            const totalSeconds = Math.floor(ms / 1000);
            const h = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
            const s = (totalSeconds % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${h}:${m}:${s}`;
            document.getElementById('timer').style.color = "#2c3e50";
            document.getElementById('timer').style.fontSize = "3rem";
        }

        function notifyUser() {
            if (Notification.permission === "granted") {
                new Notification("انتهت مدة المسح", {
                    body: "انقضت الـ 24 ساعة. يجب عليك غسل رجليك في الوضوء القادم.",
                    icon: "https://via.placeholder.com/192/27ae60/ffffff?text=م", // أيقونة مؤقتة
                    requireInteraction: true,
                    lang: "ar"
                });
            }
        }

        function checkTimer() {
            const endTime = localStorage.getItem('mashEndTime');
            if (!endTime) return;

            const now = Date.now();
            const remaining = parseInt(endTime) - now;

            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('resetBtn').style.display = 'block';

            if (remaining <= 0) {
                updateDisplay(0);
                localStorage.removeItem('mashEndTime');
            } else {
                updateDisplay(remaining);
                if (!interval) {
                    interval = setInterval(() => {
                        const left = parseInt(endTime) - Date.now();
                        updateDisplay(left);
                        if (left <= 0) {
                            clearInterval(interval);
                            updateDisplay(0);
                            notifyUser();
                            localStorage.removeItem('mashEndTime');
                        }
                    }, 1000);
                }
            }
        }

        function startTimer() {
            Notification.requestPermission();
            const endTime = Date.now() + DURATION;
            localStorage.setItem('mashEndTime', endTime);
            checkTimer();
        }

        function resetTimer() {
            localStorage.removeItem('mashEndTime');
            clearInterval(interval);
            interval = null;
            document.getElementById('timer').innerText = "24:00:00";
            document.getElementById('timer').style.color = "#2c3e50";
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('resetBtn').style.display = 'none';
        }

        // تهيئة التطبيق
        checkTimer();

        // تسجيل Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>